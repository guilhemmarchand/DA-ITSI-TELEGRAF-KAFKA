# savedsearches.conf

#  _____       _   _ _   _                 _ _
# | ____|_ __ | |_(_) |_(_) ___  ___    __| (_)___  ___ _____   _____ _ __ _   _
# |  _| | '_ \| __| | __| |/ _ \/ __|  / _` | / __|/ __/ _ \ \ / / _ \ '__| | | |
# | |___| | | | |_| | |_| |  __/\__ \ | (_| | \__ \ (_| (_) \ V /  __/ |  | |_| |
# |_____|_| |_|\__|_|\__|_|\___||___/  \__,_|_|___/\___\___/ \_/ \___|_|   \__, |
#                                                                          |___/

#  _____           _
# |__  /___   ___ | | _____  ___ _ __   ___ _ __
#   / // _ \ / _ \| |/ / _ \/ _ \ '_ \ / _ \ '__|
#  / /| (_) | (_) |   <  __/  __/ |_) |  __/ |
# /____\___/ \___/|_|\_\___|\___| .__/ \___|_|
#                               |_|

# The following search will discover all zookeeper servers reporting to the telegraf metric indexes
[DA-ITSI-TELEGRAF-KAFKA-Inventory_Search_zookeeper]
search = | mcatalog values(server) as server where `telegraf_kafka_index` metric_name="zookeeper.avg_latency" OR metric_name="zookeeper.open_file_descriptor_count"\
| mvexpand server\
| eval itsi_role="zookeeper"\
| fields itsi_role, server
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#  _  __      __ _           _               _
# | |/ /__ _ / _| | ____ _  | |__  _ __ ___ | | _____ _ __ ___
# | ' // _` | |_| |/ / _` | | '_ \| '__/ _ \| |/ / _ \ '__/ __|
# | . \ (_| |  _|   < (_| | | |_) | | | (_) |   <  __/ |  \__ \
# |_|\_\__,_|_| |_|\_\__,_| |_.__/|_|  \___/|_|\_\___|_|  |___/
#

[DA-ITSI-TELEGRAF-KAFKA-Inventory_Search_kafka_brokers]
search = | mcatalog values(jolokia_agent_url) as jolokia_agent_url where `telegraf_kafka_index` metric_name="kafka_controller.ActiveControllerCount.Value"\
| mvexpand jolokia_agent_url\
| eval itsi_role="kafka_broker"\
| rex field=jolokia_agent_url "//(?<kafka_broker>[^:]*)\:"\
| fields itsi_role, jolokia_agent_url, kafka_broker
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#  _  __      __ _            ____                            _
# | |/ /__ _ / _| | ____ _   / ___|___  _ __  _ __   ___  ___| |_
# | ' // _` | |_| |/ / _` | | |   / _ \| '_ \| '_ \ / _ \/ __| __|
# | . \ (_| |  _|   < (_| | | |__| (_) | | | | | | |  __/ (__| |_
# |_|\_\__,_|_| |_|\_\__,_|  \____\___/|_| |_|_| |_|\___|\___|\__|
#

[DA-ITSI-TELEGRAF-KAFKA-Inventory_Search_kafka_connect]
search = | mcatalog values(jolokia_agent_url) as jolokia_agent_url where `telegraf_kafka_index` metric_name="kafka_connect.worker.connector-count"\
| mvexpand jolokia_agent_url\
| eval itsi_role="kafka_connect"\
| rex field=jolokia_agent_url "//(?<kafka_connect>[^:]*)\:"\
| fields itsi_role, jolokia_agent_url, kafka_connect
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#  _  __      __ _            ____                            _
# | |/ /__ _ / _| | ____ _   / ___|___  _ __  _ __   ___  ___| |_
# | ' // _` | |_| |/ / _` | | |   / _ \| '_ \| '_ \ / _ \/ __| __|
# | . \ (_| |  _|   < (_| | | |__| (_) | | | | | | |  __/ (__| |_
# |_|\_\__,_|_| |_|\_\__,_|  \____\___/|_| |_|_| |_|\___|\___|\__|
#
#  _            _
# | |_ __ _ ___| | _____
# | __/ _` / __| |/ / __|
# | || (_| \__ \   <\__ \
#  \__\__,_|___/_|\_\___/
#
#   ______                              ______  _       _   __
#  / / ___|  ___  _   _ _ __ ___ ___   / / ___|(_)_ __ | | _\ \
# | |\___ \ / _ \| | | | '__/ __/ _ \ / /\___ \| | '_ \| |/ /| |
# | | ___) | (_) | |_| | | | (_|  __// /  ___) | | | | |   < | |
# | ||____/ \___/ \__,_|_|  \___\___/_/  |____/|_|_| |_|_|\_\| |
#  \_\                                                      /_/
#

[DA-ITSI-TELEGRAF-KAFKA-Inventory_Search_kafka_tasks]
search = | mcatalog values(jolokia_agent_url) as kafka_task_nodes values(metric_name) as metric_name where `telegraf_kafka_index` metric_name="kafka_connect.source-task.source-record-poll-total" OR metric_name="kafka_connect.sink-task.sink-record-read-total" connector=* by connector\
| eval itsi_role=case(match(metric_name, "sink-task"), "kafka_sink_task", match(metric_name, "source-task"), "kafka_source_task")\
| fields - metric_name\
| rename connector as kafka_task\
| nomv kafka_task_nodes | rex field=kafka_task_nodes mode=sed "s/ /|/g"\
| fields itsi_role, kafka_task, kafka_task_nodes
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#  _  __      __ _           _              _
# | |/ /__ _ / _| | ____ _  | |_ ___  _ __ (_) ___ ___
# | ' // _` | |_| |/ / _` | | __/ _ \| '_ \| |/ __/ __|
# | . \ (_| |  _|   < (_| | | || (_) | |_) | | (__\__ \
# |_|\_\__,_|_| |_|\_\__,_|  \__\___/| .__/|_|\___|___/
#                                    |_|

[DA-ITSI-TELEGRAF-KAFKA-Inventory_Search_kafka_topics]
search = | mcatalog values(jolokia_agent_url) as jolokia_agent_url where `telegraf_kafka_index` metric_name="kafka_topic.MessagesInPerSec.Count" OR metric_name="kafka_topic.BytesInPerSec.Count" topic!="__*" by topic\
| eval itsi_role="kafka_topic"\
| rename topic as kafka_topic, jolokia_agent_url as kafka_topic_brokers\
| nomv kafka_topic_brokers | rex field=kafka_topic_brokers mode=sed "s/ /|/g"\
| fields itsi_role, kafka_topic, kafka_topic_brokers
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#  _     _       _            _ _
# | |   (_)_ __ | | _____  __| (_)_ __
# | |   | | '_ \| |/ / _ \/ _` | | '_ \
# | |___| | | | |   <  __/ (_| | | | | |
# |_____|_|_| |_|_|\_\___|\__,_|_|_| |_|
#
#  _  __      __ _                                     _ _
# | |/ /__ _ / _| | ____ _       _ __ ___   ___  _ __ (_) |_ ___  _ __
# | ' // _` | |_| |/ / _` |_____| '_ ` _ \ / _ \| '_ \| | __/ _ \| '__|
# | . \ (_| |  _|   < (_| |_____| | | | | | (_) | | | | | || (_) | |
# |_|\_\__,_|_| |_|\_\__,_|     |_| |_| |_|\___/|_| |_|_|\__\___/|_|
#

[DA-ITSI-TELEGRAF-KAFKA-Inventory_Search_linkedin_kafka_monitors]
search = | mcatalog values(jolokia_agent_url) as jolokia_agent_url where `telegraf_kafka_index` metric_name="kafka_kafka-monitor.produce-availability-avg" OR metric_name="kafka_kafka-monitor.consume-availability-avg"\
| mvexpand jolokia_agent_url\
| eval itsi_role="kafka_linkedin_monitor"
| fields itsi_role, jolokia_agent_url, kafka_linkedin_monitor
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
