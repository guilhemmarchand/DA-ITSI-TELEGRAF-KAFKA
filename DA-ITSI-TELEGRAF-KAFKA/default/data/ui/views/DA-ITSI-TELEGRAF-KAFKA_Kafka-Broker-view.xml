<form stylesheet="DA-ITSI-TELEGRAF-KAFKA:common.css" hideEdit="false" isVisible="False">
  <label>Kafka Broker - entity view</label>
  <search id="broker_activity_summary">
    <query>| mstats avg(_value) as value WHERE `telegraf_kafka_index` metric_name="kafka_topics.MessagesInPerSec.OneMinuteRate" OR metric_name="kafka_topics.BytesInPerSec.OneMinuteRate" OR metric_name="kafka_topics.BytesOutPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ by metric_name
| eval {metric_name}=value
| stats first(kafka_topics.*.OneMinuteRate) as "*"
| eval KBytesInPerSec=round(BytesInPerSec/1024, 2), KBytesOutPerSec=round(BytesOutPerSec/1024, 2), MessagesInPerSec=round(MessagesInPerSec, 2)
| fields KBytesInPerSec, KBytesOutPerSec, MessagesInPerSec</query>
    <earliest>$earliest$</earliest>
    <latest>$latest$</latest>
  </search>
  <fieldset autoRun="false" submitButton="false">
    <input type="time" searchWhenChanged="true">
      <label></label>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <search>
          <query>| mstats latest(_value) as value where `telegraf_kafka_index` metric_name="kafka_controller.OfflinePartitionsCount.Value" jolokia_agent_url=$jolokia_agent_url$ by jolokia_agent_url
| stats sum(value) as value</query>
          <earliest>-90s</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xdc4e41"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">OFFLINE PARITTIONS</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <search>
          <query>| mstats latest(_value) as value where `telegraf_kafka_index` metric_name="kafka_replica_manager.UnderReplicatedPartitions.Value" jolokia_agent_url=$jolokia_agent_url$ by jolokia_agent_url
| stats sum(value) as value</query>
          <earliest>-90s</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xdc4e41"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">UNDER-REPLICATED PARITTIONS</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <search base="broker_activity_summary">
          <query>fields MessagesInPerSec</query>
        </search>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">AVG MESSAGES/IN SEC</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <search base="broker_activity_summary">
          <query>fields KBytesInPerSec</query>
        </search>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">AVG KBYTES IN/SEC</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <search base="broker_activity_summary">
          <query>fields KBytesInPerSec</query>
        </search>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">AVG KBYTES OUT/SEC</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <input type="link" token="top_linkinput">
        <label></label>
        <choice value="chart1">BROKER ACTIVITY OVERVIEW</choice>
        <choice value="chart2">BROKER HEALTH OVERVIEW</choice>
        <choice value="chart3">ALL TOPICS REQUEST/SEC</choice>
        <choice value="chart4">LEADER PARTITIONS</choice>
        <choice value="chart5">DISKIO</choice>
        <choice value="chart6">NET</choice>
        <choice value="chart7">NETCONNECTIONS</choice>
        <choice value="chart8">DISK</choice>
        <choice value="chart9">UPTIME</choice>
        <choice value="chart10">FORECAST</choice>
        <default>chart1</default>
        <change>
          <condition value="chart1">
            <set token="chart1">true</set>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart2">
            <set token="chart2">true</set>
            <unset token="chart1"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart3">
            <set token="chart3">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart4">
            <set token="chart4">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart5">
            <set token="chart5">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart6">
            <set token="chart6">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart7">
            <set token="chart7">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart8">
            <set token="chart8">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart9"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart9">
            <set token="chart9">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart10"></unset>
          </condition>
          <condition value="chart10">
            <set token="chart10">true</set>
            <unset token="chart1"></unset>
            <unset token="chart2"></unset>
            <unset token="chart3"></unset>
            <unset token="chart4"></unset>
            <unset token="chart5"></unset>
            <unset token="chart6"></unset>
            <unset token="chart7"></unset>
            <unset token="chart8"></unset>
            <unset token="chart9"></unset>
          </condition>
        </change>
      </input>
    </panel>
  </row>
  <row depends="$chart1$">
    <panel>
      <title>All topics messages per sec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) prestats=true WHERE `telegraf_kafka_index` metric_name="kafka_topics.MessagesInPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart span=1m avg(_value) as MessagesInPerSec</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>
  <row depends="$chart1$">
    <panel>
      <title>All topics KBytesInPerSec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) as value WHERE `telegraf_kafka_index` metric_name="kafka_topics.BytesInPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ span=10s
| eval value=value/1024
| timechart avg(value) as KBytesInPerSec span=10s</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
    <panel>
      <title>All topics KBytesOutPerSec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) as value where `telegraf_kafka_index` metric_name="kafka_topics.BytesOutPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ span=10s
| eval value=value/1024
| timechart avg(value) as KBytesOutPerSec span=10s</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>
  <row depends="$chart2$">
    <panel>
      <title>OfflinePartitions</title>
      <chart>
        <search>
          <query>| mstats max(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_controller.OfflinePartitionsCount.Value" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart max(_value) as OfflinePartitions span=10s</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
    <panel>
      <title>UnderReplicatedPartitions</title>
      <chart>
        <search>
          <query>| mstats max(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_replica_manager.UnderReplicatedPartitions.Value" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart max(_value) as UnderReplicatedPartitions span=10s</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>
  <row depends="$chart2$">
    <panel>
      <title>ISR Shrinking per sec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_replica_manager.IsrShrinksPerSec.OneMinuteRate" span=10s by jolokia_agent_url 
| timechart avg(_value) as IsrShrinksPerSec</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
    <panel>
      <title>UnderReplicatedPartitions by topic</title>
      <table>
        <search>
          <query>| mstats latest(_value) as UnderReplicatedPartitions where `telegraf_kafka_index` metric_name="kafka_partition.UnderReplicatedPartitions" jolokia_agent_url=$jolokia_agent_url$ by topic | sort 0 topic</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
      </table>
    </panel>
  </row>
  <row depends="$chart3$">
    <panel>
      <title>Produce requests/sec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) prestats=true WHERE `telegraf_kafka_index` metric_name="kafka_topic.TotalProduceRequestsPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart avg(_value) as TotalProduceRequestsPerSec span=10s</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
    <panel>
      <title>Fetch requests/sec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) prestats=true WHERE `telegraf_kafka_index` metric_name="kafka_topic.TotalFetchRequestsPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ span=10s by "jolokia_agent_url"
| timechart avg(_value) as TotalFetchRequestsPerSec span=10s by "jolokia_agent_url"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>
  <row depends="$chart3$">
    <panel>
      <title>Produce failed requests/sec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) prestats=true WHERE `telegraf_kafka_index` metric_name="kafka_topic.FailedProduceRequestsPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart avg(_value) as FailedProduceRequestsPerSec span=10s</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
    <panel>
      <title>Fetch failed requests/sec</title>
      <chart>
        <search>
          <query>| mstats avg(_value) prestats=true WHERE `telegraf_kafka_index` metric_name="kafka_topic.FailedFetchRequestsPerSec.OneMinuteRate" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart avg(_value) as FailedFetchRequestsPerSec span=10s</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>

  <row depends="$chart4$">
    <panel>
      <title>Ratio leader</title>
      <chart>
        <search>
          <query>| mstats latest(_value) as value where `telegraf_kafka_index` metric_name="kafka_replica_manager.LeaderCount.Value" OR metric_name="kafka_replica_manager.PartitionCount.Value" jolokia_agent_url=$jolokia_agent_url$ span=10s BY metric_name
| eval {metric_name}=value
| stats first(kafka_replica_manager.*.Value) as "*" by _time
| eval ratio=(LeaderCount/PartitionCount)*100
| timechart span=1m max(ratio) as ratio_leader</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>

  <row depends="$chart4$">
    <panel>
      <title>Partitions count</title>
      <chart>
        <search>
          <query>| mstats max(_value) prestats=true WHERE `telegraf_kafka_index` metric_name="kafka_replica_manager.PartitionCount.Value" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart max(_value) as PartitionCount</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
    <panel>
      <title>Leader count</title>
      <chart>
        <search>
          <query>| mstats avg(_value) prestats=true WHERE `telegraf_kafka_index` metric_name="kafka_replica_manager.LeaderCount.Value" jolokia_agent_url=$jolokia_agent_url$ span=10s
| timechart avg(_value) as LeaderCount</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>

</form>